"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// netlify/functions/analyze-story-background.ts
var analyze_story_background_exports = {};
__export(analyze_story_background_exports, {
  default: () => analyze_story_background_default
});
module.exports = __toCommonJS(analyze_story_background_exports);

// lib/supabase.ts
var import_supabase_js = require("@supabase/supabase-js");
var supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
var supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
var supabase = (0, import_supabase_js.createClient)(supabaseUrl, supabaseAnonKey);
async function updateAgentStory(id, data) {
  const { data: result, error } = await supabase.from("agent_stories").update(data).eq("id", id).select().single();
  if (error) {
    console.error("Error updating agent story:", error);
    throw error;
  }
  return result;
}

// netlify/functions/analyze-story-background.ts
var import_genai = require("@google/genai");
var GEMINI_API_KEY = process.env.GEMINI_API_KEY;
var analyze_story_background_default = async (req) => {
  const startTime = Date.now();
  console.log("[Agent Story] Starting background analysis with Gemini 3...");
  try {
    const url = new URL(req.url);
    const emiten = url.searchParams.get("emiten")?.toUpperCase();
    const storyId = url.searchParams.get("id");
    if (!emiten || !storyId) {
      return new Response(JSON.stringify({ error: "Missing emiten or id" }), { status: 400 });
    }
    if (!GEMINI_API_KEY) {
      await updateAgentStory(parseInt(storyId), {
        status: "error",
        error_message: "GEMINI_API_KEY not configured"
      });
      return new Response(JSON.stringify({ error: "API key not configured" }), { status: 500 });
    }
    await updateAgentStory(parseInt(storyId), { status: "processing" });
    console.log(`[Agent Story] Analyzing ${emiten} using Gemini 3 Flash Preview (Thinking HIGH)...`);
    const ai = new import_genai.GoogleGenAI({
      apiKey: GEMINI_API_KEY
    });
    const config = {
      thinkingConfig: {
        thinkingLevel: import_genai.ThinkingLevel.HIGH
      }
    };
    const today = (/* @__PURE__ */ new Date()).toLocaleDateString("id-ID", { day: "numeric", month: "long", year: "numeric" });
    const model = "gemini-3-flash-preview";
    const systemPrompt = "Kamu adalah seorang analis saham profesional Indonesia yang ahli dalam menganalisa story dan katalis pergerakan harga saham.";
    const userPrompt = `Hari ini adalah ${today}.
Cari dan analisa berita-berita TERBARU (bulan ini/minggu ini) tentang emiten saham Indonesia dengan kode ${emiten} dari internet menggunakan Google Search. 

FOKUS ANALISA:
1. Fokus sepenuhnya pada STORY BISNIS, AKSI KORPORASI, dan KATALIS fundamental/sentimen.
2. ABAIKAN data harga saham (price action) karena data harga dari internet seringkali tidak akurat atau delay. Jangan menyebutkan angka harga saham spesifik dalam analisis.
3. Hubungkan berita yang ditemukan dengan logika pasar: mengapa berita ini bagus/buruk untuk masa depan perusahaan?
4. Sebutkan tanggal rilis berita yang kamu gunakan sebagai referensi di dalam deskripsi katalis. 

Berikan analisis dalam format JSON dengan struktur berikut (PASTIKAN HANYA OUTPUT JSON, tanpa markdown code block agar mudah di-parse):
{
  "matriks_story": [
    {
      "kategori_story": "Transformasi Bisnis | Aksi Korporasi | Pemulihan Fundamental | Kondisi Makro",
      "deskripsi_katalis": "deskripsi singkat katalis",
      "logika_ekonomi_pasar": "penjelasan logika ekonomi/pasar",
      "potensi_dampak_harga": "dampak terhadap harga saham"
    }
  ],
  "swot_analysis": {
    "strengths": ["kekuatan perusahaan"],
    "weaknesses": ["kelemahan perusahaan"],
    "opportunities": ["peluang pasar"],
    "threats": ["ancaman/risiko"]
  },
  "checklist_katalis": [
    {
      "item": "katalis yang perlu dipantau",
      "dampak_instan": "dampak jika terjadi"
    }
  ],
  "strategi_trading": {
    "tipe_saham": "jenis saham (growth/value/turnaround/dll)",
    "target_entry": "area entry yang disarankan",
    "exit_strategy": {
      "take_profit": "target take profit",
      "stop_loss": "level stop loss"
    }
  },
  "kesimpulan": "kesimpulan analisis dalam 2-3 kalimat"
}`;
    const contents = [
      {
        role: "user",
        parts: [
          {
            text: `${systemPrompt}

${userPrompt}`
          }
        ]
      }
    ];
    const tools = [
      {
        googleSearch: {}
      }
    ];
    const responseStream = await ai.models.generateContentStream({
      model,
      config,
      contents,
      tools
    });
    let fullText = "";
    for await (const chunk of responseStream) {
      if (chunk.text) {
        fullText += chunk.text;
      }
    }
    console.log("[Agent Story] Gemini response received via stream");
    let analysisResult;
    try {
      const jsonMatch = fullText.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        analysisResult = JSON.parse(jsonMatch[0]);
      } else {
        throw new Error("No JSON found in response");
      }
    } catch (parseError) {
      console.error("[Agent Story] Failed to parse response:", parseError);
      console.log("[Agent Story] Raw response:", fullText);
      await updateAgentStory(parseInt(storyId), {
        status: "error",
        error_message: "Failed to parse AI response"
      });
      return new Response(JSON.stringify({ error: "Parse error" }), { status: 500 });
    }
    await updateAgentStory(parseInt(storyId), {
      status: "completed",
      matriks_story: analysisResult.matriks_story || [],
      swot_analysis: analysisResult.swot_analysis || {},
      checklist_katalis: analysisResult.checklist_katalis || [],
      strategi_trading: analysisResult.strategi_trading || {},
      kesimpulan: analysisResult.kesimpulan || ""
    });
    const duration = (Date.now() - startTime) / 1e3;
    console.log(`[Agent Story] Analysis completed for ${emiten} in ${duration}s`);
    return new Response(JSON.stringify({ success: true, emiten }), { status: 200 });
  } catch (error) {
    console.error("[Agent Story] Critical error:", error);
    return new Response(JSON.stringify({ error: String(error) }), { status: 500 });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibmV0bGlmeS9mdW5jdGlvbnMvYW5hbHl6ZS1zdG9yeS1iYWNrZ3JvdW5kLnRzIiwgImxpYi9zdXBhYmFzZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgdXBkYXRlQWdlbnRTdG9yeSB9IGZyb20gJy4uLy4uL2xpYi9zdXBhYmFzZSc7XHJcbmltcG9ydCB7IEdvb2dsZUdlbkFJLCBUaGlua2luZ0xldmVsIH0gZnJvbSAnQGdvb2dsZS9nZW5haSc7XHJcblxyXG5jb25zdCBHRU1JTklfQVBJX0tFWSA9IHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgKHJlcTogUmVxdWVzdCkgPT4ge1xyXG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgY29uc29sZS5sb2coJ1tBZ2VudCBTdG9yeV0gU3RhcnRpbmcgYmFja2dyb3VuZCBhbmFseXNpcyB3aXRoIEdlbWluaSAzLi4uJyk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcS51cmwpO1xyXG4gICAgY29uc3QgZW1pdGVuID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2VtaXRlbicpPy50b1VwcGVyQ2FzZSgpO1xyXG4gICAgY29uc3Qgc3RvcnlJZCA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdpZCcpO1xyXG5cclxuICAgIGlmICghZW1pdGVuIHx8ICFzdG9yeUlkKSB7XHJcbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogJ01pc3NpbmcgZW1pdGVuIG9yIGlkJyB9KSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIUdFTUlOSV9BUElfS0VZKSB7XHJcbiAgICAgIGF3YWl0IHVwZGF0ZUFnZW50U3RvcnkocGFyc2VJbnQoc3RvcnlJZCksIHtcclxuICAgICAgICBzdGF0dXM6ICdlcnJvcicsXHJcbiAgICAgICAgZXJyb3JfbWVzc2FnZTogJ0dFTUlOSV9BUElfS0VZIG5vdCBjb25maWd1cmVkJ1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IGVycm9yOiAnQVBJIGtleSBub3QgY29uZmlndXJlZCcgfSksIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXBkYXRlIHN0YXR1cyB0byBwcm9jZXNzaW5nXHJcbiAgICBhd2FpdCB1cGRhdGVBZ2VudFN0b3J5KHBhcnNlSW50KHN0b3J5SWQpLCB7IHN0YXR1czogJ3Byb2Nlc3NpbmcnIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbQWdlbnQgU3RvcnldIEFuYWx5emluZyAke2VtaXRlbn0gdXNpbmcgR2VtaW5pIDMgRmxhc2ggUHJldmlldyAoVGhpbmtpbmcgSElHSCkuLi5gKTtcclxuXHJcbiAgICBjb25zdCBhaSA9IG5ldyBHb29nbGVHZW5BSSh7XHJcbiAgICAgIGFwaUtleTogR0VNSU5JX0FQSV9LRVksXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBjb25maWcgPSB7XHJcbiAgICAgIHRoaW5raW5nQ29uZmlnOiB7XHJcbiAgICAgICAgdGhpbmtpbmdMZXZlbDogVGhpbmtpbmdMZXZlbC5ISUdILFxyXG4gICAgICB9LFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdpZC1JRCcsIHsgZGF5OiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIHllYXI6ICdudW1lcmljJyB9KTtcclxuICAgIGNvbnN0IG1vZGVsID0gJ2dlbWluaS0zLWZsYXNoLXByZXZpZXcnO1xyXG4gICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gXCJLYW11IGFkYWxhaCBzZW9yYW5nIGFuYWxpcyBzYWhhbSBwcm9mZXNpb25hbCBJbmRvbmVzaWEgeWFuZyBhaGxpIGRhbGFtIG1lbmdhbmFsaXNhIHN0b3J5IGRhbiBrYXRhbGlzIHBlcmdlcmFrYW4gaGFyZ2Egc2FoYW0uXCI7XHJcbiAgICBjb25zdCB1c2VyUHJvbXB0ID0gYEhhcmkgaW5pIGFkYWxhaCAke3RvZGF5fS5cclxuQ2FyaSBkYW4gYW5hbGlzYSBiZXJpdGEtYmVyaXRhIFRFUkJBUlUgKGJ1bGFuIGluaS9taW5nZ3UgaW5pKSB0ZW50YW5nIGVtaXRlbiBzYWhhbSBJbmRvbmVzaWEgZGVuZ2FuIGtvZGUgJHtlbWl0ZW59IGRhcmkgaW50ZXJuZXQgbWVuZ2d1bmFrYW4gR29vZ2xlIFNlYXJjaC4gXHJcblxyXG5GT0tVUyBBTkFMSVNBOlxyXG4xLiBGb2t1cyBzZXBlbnVobnlhIHBhZGEgU1RPUlkgQklTTklTLCBBS1NJIEtPUlBPUkFTSSwgZGFuIEtBVEFMSVMgZnVuZGFtZW50YWwvc2VudGltZW4uXHJcbjIuIEFCQUlLQU4gZGF0YSBoYXJnYSBzYWhhbSAocHJpY2UgYWN0aW9uKSBrYXJlbmEgZGF0YSBoYXJnYSBkYXJpIGludGVybmV0IHNlcmluZ2thbGkgdGlkYWsgYWt1cmF0IGF0YXUgZGVsYXkuIEphbmdhbiBtZW55ZWJ1dGthbiBhbmdrYSBoYXJnYSBzYWhhbSBzcGVzaWZpayBkYWxhbSBhbmFsaXNpcy5cclxuMy4gSHVidW5na2FuIGJlcml0YSB5YW5nIGRpdGVtdWthbiBkZW5nYW4gbG9naWthIHBhc2FyOiBtZW5nYXBhIGJlcml0YSBpbmkgYmFndXMvYnVydWsgdW50dWsgbWFzYSBkZXBhbiBwZXJ1c2FoYWFuP1xyXG40LiBTZWJ1dGthbiB0YW5nZ2FsIHJpbGlzIGJlcml0YSB5YW5nIGthbXUgZ3VuYWthbiBzZWJhZ2FpIHJlZmVyZW5zaSBkaSBkYWxhbSBkZXNrcmlwc2kga2F0YWxpcy4gXHJcblxyXG5CZXJpa2FuIGFuYWxpc2lzIGRhbGFtIGZvcm1hdCBKU09OIGRlbmdhbiBzdHJ1a3R1ciBiZXJpa3V0IChQQVNUSUtBTiBIQU5ZQSBPVVRQVVQgSlNPTiwgdGFucGEgbWFya2Rvd24gY29kZSBibG9jayBhZ2FyIG11ZGFoIGRpLXBhcnNlKTpcclxue1xyXG4gIFwibWF0cmlrc19zdG9yeVwiOiBbXHJcbiAgICB7XHJcbiAgICAgIFwia2F0ZWdvcmlfc3RvcnlcIjogXCJUcmFuc2Zvcm1hc2kgQmlzbmlzIHwgQWtzaSBLb3Jwb3Jhc2kgfCBQZW11bGloYW4gRnVuZGFtZW50YWwgfCBLb25kaXNpIE1ha3JvXCIsXHJcbiAgICAgIFwiZGVza3JpcHNpX2thdGFsaXNcIjogXCJkZXNrcmlwc2kgc2luZ2thdCBrYXRhbGlzXCIsXHJcbiAgICAgIFwibG9naWthX2Vrb25vbWlfcGFzYXJcIjogXCJwZW5qZWxhc2FuIGxvZ2lrYSBla29ub21pL3Bhc2FyXCIsXHJcbiAgICAgIFwicG90ZW5zaV9kYW1wYWtfaGFyZ2FcIjogXCJkYW1wYWsgdGVyaGFkYXAgaGFyZ2Egc2FoYW1cIlxyXG4gICAgfVxyXG4gIF0sXHJcbiAgXCJzd290X2FuYWx5c2lzXCI6IHtcclxuICAgIFwic3RyZW5ndGhzXCI6IFtcImtla3VhdGFuIHBlcnVzYWhhYW5cIl0sXHJcbiAgICBcIndlYWtuZXNzZXNcIjogW1wia2VsZW1haGFuIHBlcnVzYWhhYW5cIl0sXHJcbiAgICBcIm9wcG9ydHVuaXRpZXNcIjogW1wicGVsdWFuZyBwYXNhclwiXSxcclxuICAgIFwidGhyZWF0c1wiOiBbXCJhbmNhbWFuL3Jpc2lrb1wiXVxyXG4gIH0sXHJcbiAgXCJjaGVja2xpc3Rfa2F0YWxpc1wiOiBbXHJcbiAgICB7XHJcbiAgICAgIFwiaXRlbVwiOiBcImthdGFsaXMgeWFuZyBwZXJsdSBkaXBhbnRhdVwiLFxyXG4gICAgICBcImRhbXBha19pbnN0YW5cIjogXCJkYW1wYWsgamlrYSB0ZXJqYWRpXCJcclxuICAgIH1cclxuICBdLFxyXG4gIFwic3RyYXRlZ2lfdHJhZGluZ1wiOiB7XHJcbiAgICBcInRpcGVfc2FoYW1cIjogXCJqZW5pcyBzYWhhbSAoZ3Jvd3RoL3ZhbHVlL3R1cm5hcm91bmQvZGxsKVwiLFxyXG4gICAgXCJ0YXJnZXRfZW50cnlcIjogXCJhcmVhIGVudHJ5IHlhbmcgZGlzYXJhbmthblwiLFxyXG4gICAgXCJleGl0X3N0cmF0ZWd5XCI6IHtcclxuICAgICAgXCJ0YWtlX3Byb2ZpdFwiOiBcInRhcmdldCB0YWtlIHByb2ZpdFwiLFxyXG4gICAgICBcInN0b3BfbG9zc1wiOiBcImxldmVsIHN0b3AgbG9zc1wiXHJcbiAgICB9XHJcbiAgfSxcclxuICBcImtlc2ltcHVsYW5cIjogXCJrZXNpbXB1bGFuIGFuYWxpc2lzIGRhbGFtIDItMyBrYWxpbWF0XCJcclxufWA7XHJcblxyXG4gICAgY29uc3QgY29udGVudHMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgcGFydHM6IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgdGV4dDogYCR7c3lzdGVtUHJvbXB0fVxcblxcbiR7dXNlclByb21wdH1gLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdLFxyXG4gICAgICB9LFxyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCB0b29scyA9IFtcclxuICAgICAge1xyXG4gICAgICAgIGdvb2dsZVNlYXJjaDoge30sXHJcbiAgICAgIH0sXHJcbiAgICBdIGFzIGFueTtcclxuXHJcbiAgICBjb25zdCByZXNwb25zZVN0cmVhbSA9IGF3YWl0IChhaS5tb2RlbHMgYXMgYW55KS5nZW5lcmF0ZUNvbnRlbnRTdHJlYW0oe1xyXG4gICAgICBtb2RlbCxcclxuICAgICAgY29uZmlnLFxyXG4gICAgICBjb250ZW50cyxcclxuICAgICAgdG9vbHMsXHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgZnVsbFRleHQgPSAnJztcclxuICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgcmVzcG9uc2VTdHJlYW0pIHtcclxuICAgICAgaWYgKGNodW5rLnRleHQpIHtcclxuICAgICAgICBmdWxsVGV4dCArPSBjaHVuay50ZXh0O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1tBZ2VudCBTdG9yeV0gR2VtaW5pIHJlc3BvbnNlIHJlY2VpdmVkIHZpYSBzdHJlYW0nKTtcclxuXHJcbiAgICAvLyBQYXJzZSBKU09OIGZyb20gcmVzcG9uc2VcclxuICAgIGxldCBhbmFseXNpc1Jlc3VsdDtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGpzb25NYXRjaCA9IGZ1bGxUZXh0Lm1hdGNoKC9cXHtbXFxzXFxTXSpcXH0vKTtcclxuICAgICAgaWYgKGpzb25NYXRjaCkge1xyXG4gICAgICAgIGFuYWx5c2lzUmVzdWx0ID0gSlNPTi5wYXJzZShqc29uTWF0Y2hbMF0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gSlNPTiBmb3VuZCBpbiByZXNwb25zZScpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBZ2VudCBTdG9yeV0gRmFpbGVkIHRvIHBhcnNlIHJlc3BvbnNlOicsIHBhcnNlRXJyb3IpO1xyXG4gICAgICBjb25zb2xlLmxvZygnW0FnZW50IFN0b3J5XSBSYXcgcmVzcG9uc2U6JywgZnVsbFRleHQpO1xyXG4gICAgICBhd2FpdCB1cGRhdGVBZ2VudFN0b3J5KHBhcnNlSW50KHN0b3J5SWQpLCB7XHJcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxyXG4gICAgICAgIGVycm9yX21lc3NhZ2U6ICdGYWlsZWQgdG8gcGFyc2UgQUkgcmVzcG9uc2UnXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHsgZXJyb3I6ICdQYXJzZSBlcnJvcicgfSksIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2F2ZSBzdWNjZXNzZnVsIHJlc3VsdFxyXG4gICAgYXdhaXQgdXBkYXRlQWdlbnRTdG9yeShwYXJzZUludChzdG9yeUlkKSwge1xyXG4gICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxyXG4gICAgICBtYXRyaWtzX3N0b3J5OiBhbmFseXNpc1Jlc3VsdC5tYXRyaWtzX3N0b3J5IHx8IFtdLFxyXG4gICAgICBzd290X2FuYWx5c2lzOiBhbmFseXNpc1Jlc3VsdC5zd290X2FuYWx5c2lzIHx8IHt9LFxyXG4gICAgICBjaGVja2xpc3Rfa2F0YWxpczogYW5hbHlzaXNSZXN1bHQuY2hlY2tsaXN0X2thdGFsaXMgfHwgW10sXHJcbiAgICAgIHN0cmF0ZWdpX3RyYWRpbmc6IGFuYWx5c2lzUmVzdWx0LnN0cmF0ZWdpX3RyYWRpbmcgfHwge30sXHJcbiAgICAgIGtlc2ltcHVsYW46IGFuYWx5c2lzUmVzdWx0Lmtlc2ltcHVsYW4gfHwgJydcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGR1cmF0aW9uID0gKERhdGUubm93KCkgLSBzdGFydFRpbWUpIC8gMTAwMDtcclxuICAgIGNvbnNvbGUubG9nKGBbQWdlbnQgU3RvcnldIEFuYWx5c2lzIGNvbXBsZXRlZCBmb3IgJHtlbWl0ZW59IGluICR7ZHVyYXRpb259c2ApO1xyXG5cclxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBzdWNjZXNzOiB0cnVlLCBlbWl0ZW4gfSksIHsgc3RhdHVzOiAyMDAgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbQWdlbnQgU3RvcnldIENyaXRpY2FsIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogU3RyaW5nKGVycm9yKSB9KSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcbn07XHJcbiIsICJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xyXG5jb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSE7XHJcblxyXG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XHJcblxyXG4vKipcclxuICogU2F2ZSBzdG9jayBxdWVyeSB0byBkYXRhYmFzZVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVTdG9ja1F1ZXJ5KGRhdGE6IHtcclxuICBlbWl0ZW46IHN0cmluZztcclxuICBzZWN0b3I/OiBzdHJpbmc7XHJcbiAgZnJvbV9kYXRlPzogc3RyaW5nO1xyXG4gIHRvX2RhdGU/OiBzdHJpbmc7XHJcbiAgYmFuZGFyPzogc3RyaW5nO1xyXG4gIGJhcmFuZ19iYW5kYXI/OiBudW1iZXI7XHJcbiAgcmF0YV9yYXRhX2JhbmRhcj86IG51bWJlcjtcclxuICBoYXJnYT86IG51bWJlcjtcclxuICBhcmE/OiBudW1iZXI7XHJcbiAgYXJiPzogbnVtYmVyO1xyXG4gIGZyYWtzaT86IG51bWJlcjtcclxuICB0b3RhbF9iaWQ/OiBudW1iZXI7XHJcbiAgdG90YWxfb2ZmZXI/OiBudW1iZXI7XHJcbiAgdG90YWxfcGFwYW4/OiBudW1iZXI7XHJcbiAgcmF0YV9yYXRhX2JpZF9vZmVyPzogbnVtYmVyO1xyXG4gIGE/OiBudW1iZXI7XHJcbiAgcD86IG51bWJlcjtcclxuICB0YXJnZXRfcmVhbGlzdGlzPzogbnVtYmVyO1xyXG4gIHRhcmdldF9tYXg/OiBudW1iZXI7XHJcbn0pIHtcclxuICBjb25zdCB7IGRhdGE6IHJlc3VsdCwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbSgnc3RvY2tfcXVlcmllcycpXHJcbiAgICAudXBzZXJ0KFtkYXRhXSwgeyBvbkNvbmZsaWN0OiAnZnJvbV9kYXRlLGVtaXRlbicgfSlcclxuICAgIC5zZWxlY3QoKTtcclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgdG8gU3VwYWJhc2U6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IHNlc3Npb24gdmFsdWUgYnkga2V5XHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2Vzc2lvblZhbHVlKGtleTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdzZXNzaW9uJylcclxuICAgIC5zZWxlY3QoJ3ZhbHVlJylcclxuICAgIC5lcSgna2V5Jywga2V5KVxyXG4gICAgLnNpbmdsZSgpO1xyXG5cclxuICBpZiAoZXJyb3IgfHwgIWRhdGEpIHJldHVybiBudWxsO1xyXG4gIHJldHVybiBkYXRhLnZhbHVlO1xyXG59XHJcblxyXG4vKipcclxuICogVXBzZXJ0IHNlc3Npb24gdmFsdWVcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cHNlcnRTZXNzaW9uKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdzZXNzaW9uJylcclxuICAgIC51cHNlcnQoXHJcbiAgICAgIHsga2V5LCB2YWx1ZSwgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0sXHJcbiAgICAgIHsgb25Db25mbGljdDogJ2tleScgfVxyXG4gICAgKVxyXG4gICAgLnNlbGVjdCgpO1xyXG5cclxuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICogU2F2ZSB3YXRjaGxpc3QgYW5hbHlzaXMgdG8gZGF0YWJhc2UgKHJldXNpbmcgc3RvY2tfcXVlcmllcyB0YWJsZSlcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlV2F0Y2hsaXN0QW5hbHlzaXMoZGF0YToge1xyXG4gIGZyb21fZGF0ZTogc3RyaW5nOyAgLy8gYW5hbHlzaXMgZGF0ZVxyXG4gIHRvX2RhdGU6IHN0cmluZzsgICAgLy8gc2FtZSBhcyBmcm9tX2RhdGUgZm9yIGRhaWx5IGFuYWx5c2lzXHJcbiAgZW1pdGVuOiBzdHJpbmc7XHJcbiAgc2VjdG9yPzogc3RyaW5nO1xyXG4gIGJhbmRhcj86IHN0cmluZztcclxuICBiYXJhbmdfYmFuZGFyPzogbnVtYmVyO1xyXG4gIHJhdGFfcmF0YV9iYW5kYXI/OiBudW1iZXI7XHJcbiAgaGFyZ2E/OiBudW1iZXI7XHJcbiAgYXJhPzogbnVtYmVyOyAgICAgICAvLyBvZmZlcl90ZXJhdGFzXHJcbiAgYXJiPzogbnVtYmVyOyAgICAgICAvLyBiaWRfdGVyYmF3YWhcclxuICBmcmFrc2k/OiBudW1iZXI7XHJcbiAgdG90YWxfYmlkPzogbnVtYmVyO1xyXG4gIHRvdGFsX29mZmVyPzogbnVtYmVyO1xyXG4gIHRvdGFsX3BhcGFuPzogbnVtYmVyO1xyXG4gIHJhdGFfcmF0YV9iaWRfb2Zlcj86IG51bWJlcjtcclxuICBhPzogbnVtYmVyO1xyXG4gIHA/OiBudW1iZXI7XHJcbiAgdGFyZ2V0X3JlYWxpc3Rpcz86IG51bWJlcjtcclxuICB0YXJnZXRfbWF4PzogbnVtYmVyO1xyXG4gIHN0YXR1cz86IHN0cmluZztcclxuICBlcnJvcl9tZXNzYWdlPzogc3RyaW5nO1xyXG59KSB7XHJcbiAgY29uc3QgeyBkYXRhOiByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oJ3N0b2NrX3F1ZXJpZXMnKVxyXG4gICAgLnVwc2VydChbZGF0YV0sIHsgb25Db25mbGljdDogJ2Zyb21fZGF0ZSxlbWl0ZW4nIH0pXHJcbiAgICAuc2VsZWN0KCk7XHJcblxyXG4gIGlmIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIHdhdGNobGlzdCBhbmFseXNpczonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcblxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgd2F0Y2hsaXN0IGFuYWx5c2lzIGhpc3Rvcnkgd2l0aCBvcHRpb25hbCBmaWx0ZXJzXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V2F0Y2hsaXN0QW5hbHlzaXNIaXN0b3J5KGZpbHRlcnM/OiB7XHJcbiAgZW1pdGVuPzogc3RyaW5nO1xyXG4gIHNlY3Rvcj86IHN0cmluZztcclxuICBmcm9tRGF0ZT86IHN0cmluZztcclxuICB0b0RhdGU/OiBzdHJpbmc7XHJcbiAgc3RhdHVzPzogc3RyaW5nO1xyXG4gIGxpbWl0PzogbnVtYmVyO1xyXG4gIG9mZnNldD86IG51bWJlcjtcclxuICBzb3J0Qnk/OiBzdHJpbmc7XHJcbiAgc29ydE9yZGVyPzogJ2FzYycgfCAnZGVzYyc7XHJcbn0pIHtcclxuICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgLmZyb20oJ3N0b2NrX3F1ZXJpZXMnKVxyXG4gICAgLnNlbGVjdCgnKicsIHsgY291bnQ6ICdleGFjdCcgfSk7XHJcblxyXG4gIC8vIEhhbmRsZSBzb3J0aW5nXHJcbiAgY29uc3Qgc29ydEJ5ID0gZmlsdGVycz8uc29ydEJ5IHx8ICdmcm9tX2RhdGUnO1xyXG4gIGNvbnN0IHNvcnRPcmRlciA9IGZpbHRlcnM/LnNvcnRPcmRlciB8fCAnZGVzYyc7XHJcblxyXG4gIGlmIChzb3J0QnkgPT09ICdjb21iaW5lZCcpIHtcclxuICAgIC8vIFNvcnQgYnkgZGF0ZSB0aGVuIGVtaXRlblxyXG4gICAgcXVlcnkgPSBxdWVyeVxyXG4gICAgICAub3JkZXIoJ2Zyb21fZGF0ZScsIHsgYXNjZW5kaW5nOiBzb3J0T3JkZXIgPT09ICdhc2MnIH0pXHJcbiAgICAgIC5vcmRlcignZW1pdGVuJywgeyBhc2NlbmRpbmc6IHNvcnRPcmRlciA9PT0gJ2FzYycgfSk7XHJcbiAgfSBlbHNlIGlmIChzb3J0QnkgPT09ICdlbWl0ZW4nKSB7XHJcbiAgICAvLyBXaGVuIHNvcnRpbmcgYnkgZW1pdGVuLCBzZWNvbmRhcnkgc29ydCBieSBkYXRlIGFzY2VuZGluZ1xyXG4gICAgcXVlcnkgPSBxdWVyeVxyXG4gICAgICAub3JkZXIoJ2VtaXRlbicsIHsgYXNjZW5kaW5nOiBzb3J0T3JkZXIgPT09ICdhc2MnIH0pXHJcbiAgICAgIC5vcmRlcignZnJvbV9kYXRlJywgeyBhc2NlbmRpbmc6IHRydWUgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHF1ZXJ5ID0gcXVlcnkub3JkZXIoc29ydEJ5LCB7IGFzY2VuZGluZzogc29ydE9yZGVyID09PSAnYXNjJyB9KTtcclxuICB9XHJcblxyXG4gIGlmIChmaWx0ZXJzPy5lbWl0ZW4pIHtcclxuICAgIGNvbnN0IGVtaXRlbkxpc3QgPSBmaWx0ZXJzLmVtaXRlbi5zcGxpdCgvXFxzKy8pLmZpbHRlcihCb29sZWFuKTtcclxuICAgIGlmIChlbWl0ZW5MaXN0Lmxlbmd0aCA+IDApIHsgLy8gQ2hhbmdlZCB0byBhbHdheXMgdXNlIC5pbigpIGlmIGVtaXRlbnMgYXJlIHByZXNlbnRcclxuICAgICAgcXVlcnkgPSBxdWVyeS5pbignZW1pdGVuJywgZW1pdGVuTGlzdCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGlmIChmaWx0ZXJzPy5zZWN0b3IpIHtcclxuICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3NlY3RvcicsIGZpbHRlcnMuc2VjdG9yKTtcclxuICB9XHJcbiAgaWYgKGZpbHRlcnM/LmZyb21EYXRlKSB7XHJcbiAgICBxdWVyeSA9IHF1ZXJ5Lmd0ZSgnZnJvbV9kYXRlJywgZmlsdGVycy5mcm9tRGF0ZSk7XHJcbiAgfVxyXG4gIGlmIChmaWx0ZXJzPy50b0RhdGUpIHtcclxuICAgIHF1ZXJ5ID0gcXVlcnkubHRlKCdmcm9tX2RhdGUnLCBmaWx0ZXJzLnRvRGF0ZSk7XHJcbiAgfVxyXG4gIGlmIChmaWx0ZXJzPy5zdGF0dXMpIHtcclxuICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3N0YXR1cycsIGZpbHRlcnMuc3RhdHVzKTtcclxuICB9XHJcbiAgaWYgKGZpbHRlcnM/LmxpbWl0KSB7XHJcbiAgICBxdWVyeSA9IHF1ZXJ5LmxpbWl0KGZpbHRlcnMubGltaXQpO1xyXG4gIH1cclxuICBpZiAoZmlsdGVycz8ub2Zmc2V0KSB7XHJcbiAgICBxdWVyeSA9IHF1ZXJ5LnJhbmdlKGZpbHRlcnMub2Zmc2V0LCBmaWx0ZXJzLm9mZnNldCArIChmaWx0ZXJzLmxpbWl0IHx8IDUwKSAtIDEpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciwgY291bnQgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHdhdGNobGlzdCBhbmFseXNpczonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcblxyXG4gIHJldHVybiB7IGRhdGEsIGNvdW50IH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgbGF0ZXN0IHN0b2NrIHF1ZXJ5IGZvciBhIHNwZWNpZmljIGVtaXRlblxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldExhdGVzdFN0b2NrUXVlcnkoZW1pdGVuOiBzdHJpbmcpIHtcclxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oJ3N0b2NrX3F1ZXJpZXMnKVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuZXEoJ2VtaXRlbicsIGVtaXRlbilcclxuICAgIC5lcSgnc3RhdHVzJywgJ3N1Y2Nlc3MnKVxyXG4gICAgLm9yZGVyKCdmcm9tX2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgIC5saW1pdCgxKVxyXG4gICAgLnNpbmdsZSgpO1xyXG5cclxuICBpZiAoZXJyb3IpIHJldHVybiBudWxsO1xyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICogVXBkYXRlIHRoZSBtb3N0IHJlY2VudCBwcmV2aW91cyBkYXkncyByZWFsIHByaWNlIGZvciBhbiBlbWl0ZW5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVQcmV2aW91c0RheVJlYWxQcmljZShlbWl0ZW46IHN0cmluZywgY3VycmVudERhdGU6IHN0cmluZywgcHJpY2U6IG51bWJlcikge1xyXG4gIC8vIDEuIEZpbmQgdGhlIGxhdGVzdCBzdWNjZXNzZnVsIHJlY29yZCBiZWZvcmUgY3VycmVudERhdGVcclxuICBjb25zdCB7IGRhdGE6IHJlY29yZCwgZXJyb3I6IGZpbmRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdzdG9ja19xdWVyaWVzJylcclxuICAgIC5zZWxlY3QoJ2lkLCBmcm9tX2RhdGUnKVxyXG4gICAgLmVxKCdlbWl0ZW4nLCBlbWl0ZW4pXHJcbiAgICAuZXEoJ3N0YXR1cycsICdzdWNjZXNzJylcclxuICAgIC5sdCgnZnJvbV9kYXRlJywgY3VycmVudERhdGUpXHJcbiAgICAub3JkZXIoJ2Zyb21fZGF0ZScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgLmxpbWl0KDEpXHJcbiAgICAuc2luZ2xlKCk7XHJcblxyXG4gIGlmIChmaW5kRXJyb3IgfHwgIXJlY29yZCkge1xyXG4gICAgaWYgKGZpbmRFcnJvciAmJiBmaW5kRXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2JykgeyAvLyBQR1JTVDExNiBpcyBcIm5vIHJvd3MgcmV0dXJuZWRcIlxyXG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBmaW5kaW5nIHByZXZpb3VzIHJlY29yZCBmb3IgJHtlbWl0ZW59IGJlZm9yZSAke2N1cnJlbnREYXRlfTpgLCBmaW5kRXJyb3IpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyAyLiBVcGRhdGUgdGhhdCByZWNvcmQgd2l0aCB0aGUgbmV3IHByaWNlXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbSgnc3RvY2tfcXVlcmllcycpXHJcbiAgICAudXBkYXRlKHsgcmVhbF9oYXJnYTogcHJpY2UgfSlcclxuICAgIC5lcSgnaWQnLCByZWNvcmQuaWQpXHJcbiAgICAuc2VsZWN0KCk7XHJcblxyXG4gIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihgRXJyb3IgdXBkYXRpbmcgcmVhbF9oYXJnYSBmb3IgJHtlbWl0ZW59IG9uICR7cmVjb3JkLmZyb21fZGF0ZX06YCwgdXBkYXRlRXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYSBuZXcgYWdlbnQgc3RvcnkgcmVjb3JkIHdpdGggcGVuZGluZyBzdGF0dXNcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBZ2VudFN0b3J5KGVtaXRlbjogc3RyaW5nKSB7XHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdhZ2VudF9zdG9yaWVzJylcclxuICAgIC5pbnNlcnQoeyBlbWl0ZW4sIHN0YXR1czogJ3BlbmRpbmcnIH0pXHJcbiAgICAuc2VsZWN0KClcclxuICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBhZ2VudCBzdG9yeTonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcblxyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICogVXBkYXRlIGFnZW50IHN0b3J5IHdpdGggcmVzdWx0IG9yIGVycm9yXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRTdG9yeShpZDogbnVtYmVyLCBkYXRhOiB7XHJcbiAgc3RhdHVzOiAncHJvY2Vzc2luZycgfCAnY29tcGxldGVkJyB8ICdlcnJvcic7XHJcbiAgbWF0cmlrc19zdG9yeT86IG9iamVjdFtdO1xyXG4gIHN3b3RfYW5hbHlzaXM/OiBvYmplY3Q7XHJcbiAgY2hlY2tsaXN0X2thdGFsaXM/OiBvYmplY3RbXTtcclxuICBzdHJhdGVnaV90cmFkaW5nPzogb2JqZWN0O1xyXG4gIGtlc2ltcHVsYW4/OiBzdHJpbmc7XHJcbiAgZXJyb3JfbWVzc2FnZT86IHN0cmluZztcclxufSkge1xyXG4gIGNvbnN0IHsgZGF0YTogcmVzdWx0LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdhZ2VudF9zdG9yaWVzJylcclxuICAgIC51cGRhdGUoZGF0YSlcclxuICAgIC5lcSgnaWQnLCBpZClcclxuICAgIC5zZWxlY3QoKVxyXG4gICAgLnNpbmdsZSgpO1xyXG5cclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGFnZW50IHN0b3J5OicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBsYXRlc3QgYWdlbnQgc3RvcnkgZm9yIGFuIGVtaXRlblxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFnZW50U3RvcnlCeUVtaXRlbihlbWl0ZW46IHN0cmluZykge1xyXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbSgnYWdlbnRfc3RvcmllcycpXHJcbiAgICAuc2VsZWN0KCcqJylcclxuICAgIC5lcSgnZW1pdGVuJywgZW1pdGVuLnRvVXBwZXJDYXNlKCkpXHJcbiAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgIC5saW1pdCgxKVxyXG4gICAgLnNpbmdsZSgpO1xyXG5cclxuICBpZiAoZXJyb3IgJiYgZXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2Jykge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYWdlbnQgc3Rvcnk6JywgZXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRhdGEgfHwgbnVsbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhbGwgYWdlbnQgc3RvcmllcyBmb3IgYW4gZW1pdGVuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRTdG9yaWVzQnlFbWl0ZW4oZW1pdGVuOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAyMCkge1xyXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbSgnYWdlbnRfc3RvcmllcycpXHJcbiAgICAuc2VsZWN0KCcqJylcclxuICAgIC5lcSgnZW1pdGVuJywgZW1pdGVuLnRvVXBwZXJDYXNlKCkpXHJcbiAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgIC5saW1pdChsaW1pdCk7XHJcblxyXG4gIGlmIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYWdlbnQgc3RvcmllczonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcblxyXG4gIHJldHVybiBkYXRhIHx8IFtdO1xyXG59XHJcblxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7OztBQ0FBLHlCQUE2QjtBQUU3QixJQUFNLGNBQWMsUUFBUSxJQUFJO0FBQ2hDLElBQU0sa0JBQWtCLFFBQVEsSUFBSTtBQUU3QixJQUFNLGVBQVcsaUNBQWEsYUFBYSxlQUFlO0FBNlBqRSxlQUFzQixpQkFBaUIsSUFBWSxNQVFoRDtBQUNELFFBQU0sRUFBRSxNQUFNLFFBQVEsTUFBTSxJQUFJLE1BQU0sU0FDbkMsS0FBSyxlQUFlLEVBQ3BCLE9BQU8sSUFBSSxFQUNYLEdBQUcsTUFBTSxFQUFFLEVBQ1gsT0FBTyxFQUNQLE9BQU87QUFFVixNQUFJLE9BQU87QUFDVCxZQUFRLE1BQU0sK0JBQStCLEtBQUs7QUFDbEQs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
